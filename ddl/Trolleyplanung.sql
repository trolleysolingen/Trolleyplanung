-- MySQL Script generated by MySQL Workbench
-- 09/26/14 13:47:57
-- Model: New Model    Version: 1.0
SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema trolleyplanung
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `trolleyplanung` ;
CREATE SCHEMA IF NOT EXISTS `trolleyplanung` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci ;
USE `trolleyplanung` ;
GRANT ALL PRIVILEGES ON trolleyplanung.* TO trolleyuser@localhost IDENTIFIED BY 'trolley14$user';

-- -----------------------------------------------------
-- Table `congregations`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `congregations` ;

CREATE TABLE IF NOT EXISTS `congregations` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(100) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `roles`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `roles` ;

CREATE TABLE IF NOT EXISTS `roles` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `name` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`id`))
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `publishers`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `publishers` ;

CREATE TABLE IF NOT EXISTS `publishers` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `email` VARCHAR(100) NULL,
  `password` VARCHAR(100) NULL,
  `prename` VARCHAR(50) NOT NULL,
  `surname` VARCHAR(50) NOT NULL,
  `congregation_id` INT NULL,
  `role_id` INT NOT NULL,
  `phone` VARCHAR(20) NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_publisher_congregation_idx` (`congregation_id` ASC),
  INDEX `fk_publisher_role_idx` (`role_id` ASC),
  CONSTRAINT `fk_publishers_congregations`
    FOREIGN KEY (`congregation_id`)
    REFERENCES `congregations` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_publishers_roles`
    FOREIGN KEY (`role_id`)
    REFERENCES `roles` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `timeslots`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `timeslots` ;

CREATE TABLE IF NOT EXISTS `timeslots` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `congregation_id` INT NULL,
  `start` VARCHAR(5) NOT NULL,
  `end` VARCHAR(5) NOT NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_timeslots_congregation_idx` (`congregation_id` ASC),
  CONSTRAINT `fk_timeslots_congregations`
    FOREIGN KEY (`congregation_id`)
    REFERENCES `congregations` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `reservations`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `reservations` ;

CREATE TABLE IF NOT EXISTS `reservations` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `congregation_id` INT NOT NULL,
  `day` DATE NOT NULL,
  `timeslot_id` INT NOT NULL,
  `publisher1_id` INT NULL,
  `publisher2_id` INT NULL,
  `guestname` VARCHAR(100) NULL,
  created datetime NULL,
  modified datetime NULL,
  PRIMARY KEY (`id`),
  INDEX `fk_reservation_timeslot_idx` (`timeslot_id` ASC),
  INDEX `fk_reservation_publisher1_idx` (`publisher1_id` ASC),
  INDEX `fk_reservation_publisher2_idx` (`publisher2_id` ASC),
  INDEX `fk_reservations_congregations_idx` (`congregation_id` ASC),
  CONSTRAINT `fk_reservations_timeslots`
    FOREIGN KEY (`timeslot_id`)
    REFERENCES `timeslots` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_reservations_publishers1`
    FOREIGN KEY (`publisher1_id`)
    REFERENCES `publishers` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_reservations_publishers2`
    FOREIGN KEY (`publisher2_id`)
    REFERENCES `publishers` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_reservations_congregations`
    FOREIGN KEY (`congregation_id`)
    REFERENCES `congregations` (`id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `congregations`
-- -----------------------------------------------------
START TRANSACTION;
USE `trolleyplanung`;
INSERT INTO `congregations` (`id`, `name`) VALUES (1, 'Demo');
INSERT INTO `congregations` (`id`, `name`) VALUES (2, 'Solingen Mitte + Nord');

COMMIT;


-- -----------------------------------------------------
-- Data for table `roles`
-- -----------------------------------------------------
START TRANSACTION;
USE `trolleyplanung`;
INSERT INTO `roles` (`id`, `name`) VALUES (1, 'publisher');
INSERT INTO `roles` (`id`, `name`) VALUES (2, 'admin');
INSERT INTO `roles` (`id`, `name`) VALUES (3, 'guest');
INSERT INTO `roles` (`id`, `name`) VALUES (4, 'congregation admin');

COMMIT;


-- -----------------------------------------------------
-- Data for table `publishers`
-- -----------------------------------------------------
START TRANSACTION;
USE `trolleyplanung`;
INSERT INTO `publishers` (`id`, `email`, `prename`, `surname`, `congregation_id`, `role_id`, `phone`) VALUES (1, '', 'Gast', 'Verkuendiger', NULL, 3, NULL);
INSERT INTO `publishers` (`id`, `email`, `prename`, `surname`, `congregation_id`, `role_id`, `phone`) VALUES (2, 'j.ankenbrand@gmx.de', 'Juergen', 'Ankenbrand', 2, 2, NULL);
INSERT INTO `publishers` (`id`, `email`, `prename`, `surname`, `congregation_id`, `role_id`, `phone`) VALUES (3, 'flixmix.bornmann@me.com', 'Felix', 'Bornmann', 2, 2, NULL);
INSERT INTO `publishers` (`id`, `email`, `prename`, `surname`, `congregation_id`, `role_id`, `phone`) VALUES (4, 'test1@demo.de', 'Test1', 'Verkuendiger', 1, 1, NULL);
INSERT INTO `publishers` (`id`, `email`, `prename`, `surname`, `congregation_id`, `role_id`, `phone`) VALUES (5, 'test2@demo.de', 'Test2', 'Verkuendiger', 1, 4, NULL);
COMMIT;


-- -----------------------------------------------------
-- Data for table `timeslots`
-- -----------------------------------------------------
START TRANSACTION;
USE `trolleyplanung`;
INSERT INTO `timeslots` (`id`, `congregation_id`, `start`, `end`) VALUES (1, 1, '09:00', '13:00');
INSERT INTO `timeslots` (`id`, `congregation_id`, `start`, `end`) VALUES (2, 1, '13:00', '16:00');
INSERT INTO `timeslots` (`id`, `congregation_id`, `start`, `end`) VALUES (3, 1, '16:00', '19:00');
INSERT INTO `timeslots` (`id`, `congregation_id`, `start`, `end`) VALUES (4, 2, '07:00', '10:00');
INSERT INTO `timeslots` (`id`, `congregation_id`, `start`, `end`) VALUES (5, 2, '10:00', '13:00');
INSERT INTO `timeslots` (`id`, `congregation_id`, `start`, `end`) VALUES (6, 2, '13:00', '16:00');
INSERT INTO `timeslots` (`id`, `congregation_id`, `start`, `end`) VALUES (7, 2, '16:00', '19:00');

COMMIT;

update publishers set password = 'aaaaaa' where id = 2;
update publishers set password = 'bbbbbb' where id = 3;
update publishers set password = 'test' where id = 4;
update publishers set password = 'test' where id = 5;

alter table roles add (
  description varchar(100)
);

update roles set description = 'Verkuendiger' where id = 1;
update roles set description = 'Administrator' where id = 2;
update roles set description = 'Gast' where id = 3;
update roles set description = 'Versammlungsadministrator' where id = 4;